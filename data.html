<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="We describe the sources of our data and the cleaning process.">

<title>MA [46]15 Final Project TEAM 2 - Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project TEAM 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html" rel="" target="">
 <span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./analysis.html" rel="" target="">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./data.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#police-fatality-dataset" id="toc-police-fatality-dataset" class="nav-link" data-scroll-target="#police-fatality-dataset">Police Fatality Dataset</a></li>
  <li><a href="#u.s.-cities-demographic-dataset" id="toc-u.s.-cities-demographic-dataset" class="nav-link" data-scroll-target="#u.s.-cities-demographic-dataset">U.S. Cities Demographic Dataset</a></li>
  </ul></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">Cleaning</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data</h1>
</div>

<div>
  <div class="description">
    We describe the sources of our data and the cleaning process.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="images/data-pg-photo-crime-tape.jpeg" class="img-fluid"></p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<section id="police-fatality-dataset" class="level3">
<h3 class="anchored" data-anchor-id="police-fatality-dataset">Police Fatality Dataset</h3>
<p>The source of the original dataset is Fatal Encounters, a blog created by Dr.&nbsp;Brian Burghart, a journalist and part-time researcher for the University of Southern California. Dr.&nbsp;Burghart and his associates compiled media reports and police records to create the database. The data represents deaths that occurred when police were present or were caused by police, including “on-duty, off-duty, criminal, line-of-duty, local, federal, intentional, [and] accidental.” The goal of Fatal Encounters is to create a national database that anyone can use for whatever purpose. This dataset has 36 variables, though a few are redundant, such as Unique ID and Unique identifier (redundant), or temporary. Some of the main variables are listed in the table below. Many of the variables are self-evident and therefore are lacking a description.</p>
<table class="table">
<colgroup>
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 28%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Category</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Name</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Age</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Gender</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">URL of image (PLS NO HOTLINKS)</td>
<td style="text-align: center;">Photo of the victim</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Numeric (Date)</td>
<td style="text-align: center;">Date of injury resulting in death (month/day/year)</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Location of injury (address)</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Location of death (city)</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">State</td>
<td style="text-align: center;">Inputted as state abbreviations</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Agency or agencies involved</td>
<td style="text-align: center;">Police departments, shrieff’s offices, etc involved in the incident</td>
</tr>
<tr class="even">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Armed/Unarmed</td>
<td style="text-align: center;">Whether the victim was armed or unarmed during the incident</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Alleged weapon</td>
<td style="text-align: center;">If the victim was armed, categorizes the alleged weapon</td>
</tr>
<tr class="even">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Aggressive physical movement</td>
<td style="text-align: center;">Description of aggressive physical movement the victim performed (e.g.&nbsp;Advanced toward officer(s))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Fleeing/Not fleeing</td>
<td style="text-align: center;">Whether the victim attempted to flee, and if so by what method (e.g.&nbsp;Vehicle)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Brief description</td>
<td style="text-align: center;">A brief description of the incident</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Supporting document link</td>
<td style="text-align: center;">A link to a new article reporting the incident or a photo of an official document describing the incident</td>
</tr>
</tbody>
</table>
<p>The <a href="https://data.world/awram/us-police-involved-fatalities">cleaned dataset</a> was posted by Chris Awram to the data.world site. He cleaned the Fatal Encounters dataset and combined it with additional data from <a href="https://www.gunviolencearchive.org/">Gun Violence Archive</a> and <a href="https://data.world/data-society/fatal-police-shootings">Data Society</a>, which sourced its data from the <a href="https://github.com/washingtonpost/data-police-shootings">Washington Post</a>. The purpose of this cleaned dataset was to shed light on altercations with the police in which individuals were killed. This dataset subsets the Fatal Encounters dataset, discarding observations where the deceased individual was not killed by police or by suicide, but only in the presence of a police officer. For example, the death recorded by Unique ID 31495 in the Fatal Encounters dataset resulted from a car accident that was witnessed by a police officer. This observation was filtered out from the cleaned dataset because the deceased was neither killed by a police officer nor a victim of suicide.</p>
<p>This dataset has 12 variables, including a unique ID for each observation (uid). The variables are listed in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Category</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">name</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">age</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">gender</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Victim</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">race</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">date</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">city</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">state</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">manner_of_death</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">armed</td>
<td style="text-align: center;">What weapon, if any, the individual was carrying (e.g.&nbsp;gun)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Logical</td>
<td style="text-align: center;">mental_illness</td>
<td style="text-align: center;">Whether the individual was displaying symptoms of mental illness</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Incident</td>
<td style="text-align: center;">Logical</td>
<td style="text-align: center;">flee</td>
<td style="text-align: center;">Whether the individual attempted to flee the altercaation</td>
</tr>
</tbody>
</table>
<p>This cleaned dataset removed some supplemental details from the Fatal Encounter dataset, such as the address of incident, the corresponding latitude and longitude, the agencies involved, and a description of the incident.</p>
</section>
<section id="u.s.-cities-demographic-dataset" class="level3">
<h3 class="anchored" data-anchor-id="u.s.-cities-demographic-dataset">U.S. Cities Demographic Dataset</h3>
<p>We supplemented our police fatality dataset by joining it with a <a href="https://public.opendatasoft.com/explore/dataset/us-cities-demographics/information/">U.S. cities demographic dataset</a>. This demographic dataset was sourced from the U.S. Census Bureau’s 2015 American Community Survey and posted to the opendatasoft site by the U.S. Census Bureau. U.S. cities with populations greater than or equal to 65,000 are included in this dataset. This dataset has 12 variables, all listed in the table below. The variables Race and Count are connected, with Count describing the number of individuals of a certain race. There are multiple observations per City, each with a different Race and Count.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 26%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Category</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">City</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">State</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">Race</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Count</td>
<td style="text-align: center;">Number of individuals of a certain race</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Median Age</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Male Population</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Female Population</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Total Population</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Number of Veterans</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Integer</td>
<td style="text-align: center;">Foreign-born</td>
<td style="text-align: center;">Number of foreign-born individuals</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Demographic</td>
<td style="text-align: center;">Numeric</td>
<td style="text-align: center;">Average Household Size</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">Location</td>
<td style="text-align: center;">Character</td>
<td style="text-align: center;">State Code</td>
<td style="text-align: center;">Abbreviation of state name</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="cleaning" class="level2">
<h2 class="anchored" data-anchor-id="cleaning">Cleaning</h2>
<p>The police fatality dataset from data.world required no additional cleaning when first downloaded. Our process of loading the police fatality data can be found <a href="http://load_and_clean_data.r/">here</a>. Before we could combine datasets, we first needed to pivot the U.S. demographic dataset so that there was only one observation for each city. To do so, we used <code>pivot_longer</code> to change the Race variable into multiple Race variables (e.g.&nbsp;Asian, White), each with different values from Count. We originally joined the datasets using City as the primary key, but found issues as there are some cities with the same name but in different states. We then combined the police and demographic datasets by using <code>inner_join</code> with City as well as State Code. We set the relationship to “many-to-many” so that fatalities from the same city all had the demographic data added. As we were looking over the data, we noticed that some observations were of the same individual, but with slightly different information concerning the fatal incident. For example, two observations with different unique IDs but with the same victim information (name, race, etc) and location might have conflicting information over whether the individual fled the altercation. We decided the remove all duplicated observations as we had no way of verifying which observation was accurate (e.g.&nbsp;whether the individual fled). We did this by first using <code>group_by(Name, City, State)</code> to group the same altercations and then using <code>filter</code> to remove groups with more than one observation. We also noticed that some of the observations were missing Race values for the deceased individuals. As race is our main subject of interest, we removed these observations with <code>filter</code>. Our process of combining the datasets can be found <a href="http://combining-datasets.r/">here</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>